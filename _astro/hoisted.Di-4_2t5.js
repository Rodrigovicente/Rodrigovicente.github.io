const m=document.getElementById("intro"),v=m?.getElementsByClassName("intro-content")[0],y=document.getElementById("grid"),u=128,g=1e3,R=50;let f=[],L=!1;const C=()=>{L=!0};function F(c,t,e=100){let i;return(...s)=>{t&&t(),clearTimeout(i),i=setTimeout(()=>c(...s),e)}}m?.style.setProperty("--flip-duration",`${g/1e3}s`);const I=new ResizeObserver(F(M,C));function M(c){const t=c[0].contentRect,e=t.width,i=t.height;setTimeout(()=>{L=!1},100),console.log(e,i),m?.style.setProperty("--cell-size",`${u}px`),m?.style.setProperty("--grid-rotation",`${R}deg`);const s=Math.ceil(e/u)+1,h=Math.ceil(i*2/u/Math.cos(R*Math.PI/180))+1;let d=Math.floor(s/2),r=Math.floor(h/2);r%2===1&&(r-=1);const E=new x([new l("/brand-1-R.webp",-10),new l("/brand-2-o.webp",-40),new l("/brand-3-d.webp",-30),new l("/brand-4-r.webp",-50),new l("/brand-5-i.webp",-135),new l("/brand-6-g.webp",-100),new l("/brand-7-o.webp",-20)],.33,100),P=new x([new l("/brand-8-C.webp",-45),new l("/brand-9-a.webp",-50),new l("/brand-10-l.webp",-100),new l("/brand-11-a.webp",-100),new l("/brand-12-b.webp",-20),new l("/brand-13-r.webp",-55),new l("/brand-14-i.webp",-140),new l("/brand-15-a.webp",-100)],.33,100);if(f=[],y){const T=document.createDocumentFragment();y.innerHTML="";for(let o=0;o<h;o++){const b=document.createElement("div");b.classList.add("grid-row"),T.appendChild(b);for(let a=0;a<s;a++){let n;o==r+1&&a==d-1?n=new p({type:"button",iconName:"github",standingText:"Github",action:()=>window.open("https://github.com/Rodrigovicente")}):o==r+2&&a==d-1?n=new p({type:"button",iconName:"linkedin",standingText:"Linkedin",action:()=>window.open("https://www.linkedin.com/in/rodrigovcalabria/")}):o==r+3&&a==d?n=new p({type:"button",iconName:"mail",standingText:"Contact",action:()=>window.open("mailto:rodrigovcabria@hotmail.com")}):o==r+4&&a==d?n=new p({type:"button",iconName:"resume",standingText:"Resume",action:()=>window.open("https://github.com/Rodrigovicente")}):o==r&&a==d-2?n=new p({standingText:"Full-Stack Dev"}):o==r-3&&a==d?n=new p({type:"static",skippingLineup:E}):o==r-2&&a==d?n=new p({type:"static"}):o==r-1&&a==d+1?n=new p({type:"static"}):o==r&&a==d+1?n=new p({type:"static"}):o==r-1&&a==d?n=new p({type:"static",skippingLineup:P}):o==r&&a==d?n=new p({type:"static"}):o==r+1&&a==d+1?n=new p({type:"static"}):o==r+2&&a==d+1?n=new p({type:"static"}):(n=new p,Math.random()>.5&&n.setFlipped()),b.appendChild(n.target),f.push(n)}}y.appendChild(T)}}v&&I.observe(v);class p{isFlipped=!1;isFlipping=!1;isInverted=!1;type;target;targetInner=null;invertionTimeout=null;flipTimeout=null;constructor(t){if(t?.type==="static")this.type="static",this.target=document.createElement("div");else if(t?.type==="button"){if(t.iconName==null)throw new Error("Icon name is required for button");this.target=document.createElement("button"),this.target.classList.add("grid-wrapper"),this.target.setAttribute("type","button");const e=document.createElement("div");e.classList.add("inner-content"),e.style.setProperty("--bg-url",`url("/icon-${t.iconName}.webp")`),this.target.appendChild(e),this.target.addEventListener("pointerenter",i=>this.flip(i,!0)),this.target.addEventListener("pointerleave",i=>this.flip(i,!1)),this.target.addEventListener("click",t?.action),this.targetInner=e}else if(t?.type==="display"){this.target=document.createElement("div"),this.target.classList.add("grid-wrapper");const e=document.createElement("div");e.classList.add("inner-content"),e.classList.add("cell-display"),e.style.setProperty("--bg-url",`url("/${t.displayImage}")`),e.style.setProperty("--bg-offsetX",`-${t.offsetX*128}px`),t.offsetY?e.style.setProperty("--bg-offsetY",`-${t.offsetY*128}px`):e.style.setProperty("--bg-offsetY","0px"),this.target.appendChild(e),this.target.addEventListener("pointerenter",this.flip),this.targetInner=e}else this.target=document.createElement("div"),this.target.addEventListener("pointerenter",this.flip);if(this.target.classList.add("grid-cell"),t?.standingText){const e=document.createElement("div");if(e.classList.add("standing-text"),t.type==="button")for(let i=0;i<t.standingText.length;i++){const s=document.createElement("span");s.innerText=t.standingText[i],s.style.setProperty("--transition-delay",`${i}`),e.appendChild(s)}else e.innerText=t.standingText;this.target.appendChild(e)}t?.skippingLineup&&this.target.appendChild(t.skippingLineup.wrapper)}flip=(t,e)=>{if(this.type==="static"||(this.isFlipping||this.target==null)&&this.targetInner==null)return;e!=null?e?this.target.classList.add("flipped"):this.target.classList.remove("flipped"):(this.isFlipped=!this.isFlipped,this.target.classList.toggle("flipped")),this.isFlipping=!0,this.target.classList.add("flipping");const i=this.target.classList.contains("flipped")?g/2.4:g/6;this.invertionTimeout&&clearTimeout(this.invertionTimeout),this.flipTimeout&&clearTimeout(this.flipTimeout),this.invertionTimeout=setTimeout(()=>{this.target.classList.contains("flipped")?this.target.classList.add("inverted"):this.target.classList.remove("inverted")},i),this.flipTimeout=setTimeout(()=>{this.target.classList.remove("flipping"),this.isFlipping=!1},g)};setFlipped(t){this.targetInner||(this.isFlipped=t??!this.isFlipped,this.isFlipped?(this.target.classList.add("flipped"),this.target.classList.add("inverted")):(this.target.classList.remove("flipped"),this.target.classList.remove("inverted")))}}let w={isRunning:!1,timeout:0,flipNext:function(){if(console.log("flipping"),w.isRunning){const c=Math.floor(Math.random()*f.length);f[c]?.targetInner==null&&f[c]?.flip();const t=Math.floor(Math.random()*5e3)+1e3;this.timeout=setTimeout(()=>{this.flipNext()},t)}},start:function(){this.isRunning||(this.isRunning=!0,this.flipNext())},stop:function(){this.isRunning=!1,this.timeout&&clearTimeout(this.timeout)}};window.addEventListener("blur",()=>w.stop());window.addEventListener("focus",()=>w.start());w.start();class x{wrapper;radius;imgList=[];constructor(t,e=1,i){this.radius=i??u,this.wrapper=document.createElement("div"),this.wrapper.classList.add("lineup-wrapper"),e!==1&&this.wrapper.style.setProperty("--lineup-scale",`${e}`);for(let s=0;s<t.length;s++)this.wrapper.appendChild(t[s].img),t[s].setRadius(this.radius),this.imgList.push(t[s]);v?.addEventListener("pointermove",s=>{L||this.setPointerPosition(s.clientX,s.clientY)}),requestAnimationFrame(this.resetImgRects.bind(this))}setPointerPosition(t,e){for(let i=0;i<this.imgList.length;i++)this.imgList[i].updatePointerPosition(t,e)}resetImgRects(){console.log("reseting"),this.imgList.forEach(t=>{t.resetRect()})}}class l{img;radius;imgRect=void 0;offsetZ=0;pointerDist;skipSpeed=.2;constructor(t,e,i,s){this.radius=s??u,this.pointerDist=this.radius+1,this.img=document.createElement("img"),this.img.src=t,e&&this.img.style.setProperty("--lineup-img-offsetX",`${e}px`),i&&this.img.style.setProperty("--lineup-img-offsetY",`${i}px`),this.animateSkip()}setRadius(t){this.radius=t}updatePointerPosition=(t,e)=>{if(!this.imgRect){const h=this.img.getBoundingClientRect();this.imgRect={y:h.top+h.height/2,x:h.left+h.width/2}}const i=t-this.imgRect.x,s=e-this.imgRect.y;this.pointerDist=Math.sqrt(i**2+s**2)};animateSkip(){const e=Math.max(0,this.radius-this.pointerDist)-this.offsetZ;Math.abs(e)>.001&&(this.offsetZ+=e*this.skipSpeed,this.img.style.setProperty("--lineup-img-offsetZ",`${this.offsetZ}px`)),requestAnimationFrame(this.animateSkip.bind(this))}resetRect(){this.imgRect=void 0}}
